# ðŸš€ PHASE 3: RF Acquisition Service - START

**Date**: October 22, 2025  
**Status**: ðŸŸ¡ IN PROGRESS  
**Assignee**: Agent-Backend (fulgidus)  
**Duration**: 3 days  
**Depends On**: Phase 2 âœ…  
**Critical Path**: YES (blocks Phase 4 and 5)

---

## Quick Start Checklist

- [ ] T3.1: Implement `websdr_fetcher.py`
- [ ] T3.2: Implement `iq_processor.py`
- [ ] T3.3: Create WebSDR configuration model
- [ ] T3.4: Create Celery task `acquire_iq`
- [ ] T3.5: Create FastAPI endpoints (`/acquire`, `/status/{task_id}`)
- [ ] T3.6: Error handling and retry logic
- [ ] T3.7: DB migration for `measurements` hypertable
- [ ] T3.8: Create test fixtures
- [ ] T3.9: Integration tests
- [ ] T3.10: Performance tests

---

## Objective

Implement simultaneous WebSDR data fetching, signal processing, and Celery task integration for human-assisted recording sessions.

### Key Deliverables

- âœ… Simultaneous fetch from 7 WebSDR URLs
- âœ… IQ data recording to MinIO
- âœ… Metadata (SNR, frequency offset) to PostgreSQL/TimescaleDB
- âœ… Celery task coordination
- âœ… REST API for triggering acquisitions

---

## Implementation Priority

1. **T3.1** - `websdr_fetcher.py`: Core fetching logic for 7 receivers
2. **T3.2** - `iq_processor.py`: Signal processing utilities
3. **T3.3** - WebSDR configuration model in database
4. **T3.4** - Celery task for orchestration
5. **T3.5** - FastAPI endpoints for user interaction

---

## Reference: WebSDR Receivers (from WEBSDRS.md)

| Index | Name                   | Location       | URL                             |
| ----- | ---------------------- | -------------- | ------------------------------- |
| 1     | F5LEN (Toulouse)       | 43.5Â°N, 1.4Â°E  | http://websdr.f5len.net:8901    |
| 2     | PH0M (Pachmarke, NL)   | 52.5Â°N, 4.8Â°E  | http://websdr.pa3weg.nl:8901    |
| 3     | G0MJW (Bridgnorth, UK) | 52.5Â°N, -2.4Â°E | http://websdr.g0mjw.org.uk:8901 |
| 4     | HB9Q (Zurich)          | 47.3Â°N, 8.5Â°E  | http://websdr.hb9q.ch:8901      |
| 5     | DK0GHZ (Black Forest)  | 48.8Â°N, 8.2Â°E  | http://websdr.dk0ghz.de:8901    |
| 6     | OE3XEC (Vienna)        | 48.2Â°N, 16.3Â°E | http://websdr.oe3xec.at:8901    |
| 7     | HB9SL (St. Gallen)     | 47.4Â°N, 9.1Â°E  | http://websdr.hb9sl.ch:8901     |

---

## Architecture Overview

```
User Request (/acquire)
    â†“
FastAPI Endpoint â†’ Celery Task (acquire_iq)
    â†“
WebSDRFetcher (7x simultaneous fetches via aiohttp)
    â†“
IQProcessor (compute SNR, PSD, frequency offset)
    â†“
MinIO (store raw IQ as HDF5)
    â†“
TimescaleDB (store metadata)
    â†“
FastAPI (/status/{task_id}) â†’ User feedback
```

---

## Service Location

Main service: `services/rf-acquisition/`

Key files to implement:
```
services/rf-acquisition/src/
â”œâ”€â”€ main.py (FastAPI + Celery setup - existing)
â”œâ”€â”€ config.py (existing)
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ websdrs.py (NEW - WebSDR config model)
â”‚   â””â”€â”€ measurements.py (NEW - Measurement model)
â”œâ”€â”€ fetchers/
â”‚   â””â”€â”€ websdr_fetcher.py (NEW - Main fetcher)
â”œâ”€â”€ processors/
â”‚   â””â”€â”€ iq_processor.py (NEW - Signal processing)
â”œâ”€â”€ tasks/
â”‚   â””â”€â”€ acquire_iq.py (NEW - Celery task)
â””â”€â”€ routers/
    â””â”€â”€ acquisition.py (NEW - FastAPI endpoints)
```

---

## Entry Point

When all Phase 3 checkpoints pass:

```bash
# Verify all services running
docker compose up -d

# Run Phase 3 tests
pytest services/rf-acquisition/tests/ -v

# Check RF Acquisition service health
curl http://localhost:8001/health

# Trigger a test acquisition (mocked)
curl -X POST http://localhost:8001/acquire \
  -H "Content-Type: application/json" \
  -d '{
    "frequency_mhz": 145.5,
    "duration_seconds": 10,
    "start_time": "2025-10-22T10:00:00Z"
  }'
```

---

## Next Steps

1. âœ… Review WEBSDRS.md for receiver details
2. âœ… Review existing rf-acquisition scaffold
3. ðŸ”„ Begin T3.1: Implement websdr_fetcher.py
4. ðŸ”„ Create test fixtures for mocking WebSDR
5. ðŸ”„ Implement integration tests

---

## Continuation Point

If interrupted, resume from:
- **Current Phase**: 3 (RF Acquisition Service)
- **Last Completed**: Phase 2 (Services Scaffolding)
- **Current Focus**: Implement WebSDR fetcher and Celery integration

Update `.copilot-instructions` with any new learnings about WebSDR APIs or aiohttp concurrency patterns.

---

## Success Criteria

All Phase 3 checkpoints must pass before proceeding to Phase 4:

âœ… CP3.1: WebSDR fetcher works with all 7 receivers  
âœ… CP3.2: IQ data saved to MinIO successfully  
âœ… CP3.3: Measurements stored in TimescaleDB  
âœ… CP3.4: Celery task runs end-to-end  
âœ… CP3.5: All tests pass (coverage >80%)
